const fs = require('fs');
const path = require('path');

// Read vulnerable packages
const vulnData = fs.readFileSync('VulnerablePackagesIdentified.csv', 'utf8').split(/\r?\n/);
const vulnSet = new Set();
const vulnMap = {};
vulnData.slice(1).forEach(line => {
  const [pkg, ver] = line.split(',');
  if (pkg && ver) {
    vulnSet.add(`${pkg},${ver}`);
    vulnMap[pkg] = ver; // If multiple, will keep last
  }
});

// Read dependencies with date
const depData = fs.readFileSync('dependencies-with-date.csv', 'utf8').split(/\r?\n/);
const header = depData[0] + ',IsVulnerable,VulnerableVersion';
const outRows = [header];

depData.slice(1).forEach(line => {
  if (!line.trim()) return;
  const cols = line.split(',');
  const pkg = cols[1];
  const vulnVer = vulnMap[pkg] || '';
  outRows.push(line + `,,${vulnVer}`);
});

fs.writeFileSync('dependencies-with-date-vuln.csv', outRows.join('\n'));
console.log('CSV file created: dependencies-with-date-vuln.csv');